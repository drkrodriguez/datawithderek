<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Derek Rodriguez">
<meta name="dcterms.date" content="2024-11-28">

<title>Starting Linear Programming in Python – data with derek</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">data with derek</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/drkrodriguez/datawithderek"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/fjsrodriguez/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Starting Linear Programming in Python</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Optimization</div>
                <div class="quarto-category">Linear Programming</div>
                <div class="quarto-category">Learn With Me</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Derek Rodriguez </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 28, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In this post, I will solve a simple linear programming (LP) problem using three Python packages: <a href="https://developers.google.com/optimization">Google’s ORTools</a>, <a href="https://coin-or.github.io/pulp/index.html">PuLP</a> and <a href="https://docs.scipy.org/doc/scipy/reference/optimize.html">SciPy</a>.</p>
<p>This is the first time I am trying optimization in Python. My previous experience with solver software has been with some commercial solvers or MS Excel while I was in college, and using supply chain modeling software at work. For my first try, I am being guided by the posts of <a href="https://realpython.com/linear-programming-python/">Mirko Stojiljković from Real Python</a>, and <a href="https://towardsdatascience.com/introduction-to-linear-programming-in-python-9261e7eb44b">Maximme Labonne from Towards Data Science</a>.</p>
<p>Since I will be focusing on the packages, I won’t be explaining Linear or Mathematical Programming in this post, and will go straight to the problem, the mathematical formulation, and then the building and optimizing of the model using the three packages mentioned. Mirko’s and Maximme’s posts give good overviews, but there are a large number of material online and offline covering linear programming and operations research.</p>
<section id="a-sample-problem" class="level1">
<h1>A Sample Problem</h1>
<p>I will be using a single problem to try the three packages. I am taking a review problem from one of my college textbooks. <em>(Winston, Wayne &amp; Venkataraman. 2003. Introduction to Mathematical Programming. Operations Research: Volume One. Fourth Edition. Brooks/Cole. Thomson Learning)</em> The chosen problem will be a pure linear programming problem so we will not focus on any integer or binary variables for now.</p>
<section id="a-simple-profit-maximization-problem" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-profit-maximization-problem">A simple profit maximization problem</h2>
<p>A company produces tools at two plants and sells them to three customers.The cost of producing 1000 tools at a plant and shipping them to a customer is given in the table below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;">Plant</th>
<th style="text-align: center;">Customer 1</th>
<th style="text-align: center;">Customer 2</th>
<th style="text-align: center;">Customer 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">160</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">130</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">170</td>
</tr>
</tbody>
</table>
<p>Customers 1 and 3 pay $200 per thousand tools; Customer 2 pays $150. To produce 1,000 tools at Plant 1, 200 hours of labor are needed, while 300 hours are needed at Plant 2. A total of 5,500 hours of labor are available are available for use at the two plants. Additional labor hours can be purchased at $20 per labor hour. Plant 1 can produce up to 10,000 tools while Plant 2 can produce up to 12,000 tools. Demand by each customer is assumed to be unlimited.</p>
<p><strong>How many tools should be produced and shipped by each plant to each customer?</strong></p>
</section>
<section id="lp-formulation" class="level2">
<h2 class="anchored" data-anchor-id="lp-formulation">LP Formulation</h2>
<p>I will jump straight into fomulating the problem as an LP model by defining its three major parts: <strong><em>the decision variables, the objective funtion, the constraints</em></strong>.</p>
<p>The <strong>decision variables</strong> are the unknowns that we want to solve for. In our problem, these are:</p>
<p>$ X_{ij} =$ the number of tools in thousands produced in plant <span class="math inline">\(i\)</span> and shipped to customer <span class="math inline">\(j\)</span> for <span class="math inline">\(i = 1, 2\)</span>, and <span class="math inline">\(j = 1, 2, 3\)</span></p>
<p>$ L =$ additional labor hours to purchase</p>
<p>The <strong>objective function</strong> is a value that we want to maximize or minimize and is a function of the decision variables. As we have sales and cost figures, we would expect that we want to maximize the profit generated by our decisions:</p>
<p><strong>Maximize:</strong></p>
<p><span class="math inline">\(Z =\)</span> sales from customers + cost to ship to customers + cost of additional labor hours</p>
<p><span class="math inline">\(Z = 200 \sum_{i=1}^{2} X_{i1}\ + 150 \sum_{i=1}^{2} X_{i2}\ + 200 \sum_{i=1}^{2} X_{i3}\ - \sum t_{ij}X_{ij} \ - 20L\)</span> , where <span class="math inline">\(t_{ij}\)</span> is the cost of shipping 1000 units from plant <span class="math inline">\(i\)</span> to customer <span class="math inline">\(j\)</span></p>
<p><span class="math inline">\(Z = (200-60)X_{11} + (200-130)X_{21} + (150-30)X_{12} + (150-70)X_{22} + (200-160)X_{13} + (200-170)X_{23} - 20L\)</span></p>
<p><span class="math inline">\(Z = 140X_{11} + 70X_{21} + 120X_{12} + 80X_{22} + 40X_{13} + 30X_{23} - 20L\)</span></p>
<p>The <strong>constraints</strong> represent the conditions or requirements and limit the values that variables can take.</p>
<p>Labor constraint:</p>
<p><span class="math inline">\(200 (X_{11}+X_{12}+X_{13}) + 300(X_{21}+X_{22}+X_{23}) \leq 5500 + L\)</span></p>
<p>Production constraints:</p>
<p><span class="math inline">\(X_{11} + X_{12} + X_{13} \leq 10\)</span></p>
<p><span class="math inline">\(X_{21} + X_{22} + X_{23} \leq 12\)</span></p>
<p>Nonnegativity: <em>All variables are nonnegative</em></p>
<p><span class="math inline">\(X_{ij} \geq 0\)</span> ; for every plant <span class="math inline">\(i\)</span> and customer <span class="math inline">\(j\)</span></p>
<p><span class="math inline">\(L \geq 0\)</span></p>
</section>
</section>
<section id="solving-using-scipy" class="level1">
<h1>Solving using SciPy</h1>
<p>I will follow the steps outlined in <a href="https://realpython.com/linear-programming-python/">Mirko’s post</a> to solve the above problem using <a href="https://docs.scipy.org/doc/scipy/reference/optimize.html">SciPy</a>. The first step is to load the <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linprog.html#scipy.optimize.linprog"><code>linprog()</code></a> from SciPy’s Optimize module.</p>
<div id="879459b6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> linprog</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>linprog()</code> only works with minimization problems that don’t have constraints with greater than inequalities. (i.e., all variables on the left side are greater than or equal to a constant on the right side) Our problem is currently a maximization type, but we can solve this by negating the whole expression to turn it into a minimization problem.</p>
<p><strong>Maximize:</strong></p>
<p><span class="math inline">\(Z = 140X_{11} + 70X_{21} + 120X_{12} + 80X_{22} + 40X_{13} + 30X_{23} - 20L\)</span></p>
<p>is equivalent to, <strong>Minimize:</strong></p>
<p><span class="math inline">\(-Z = 20L -140X_{11} - 70X_{21} - 120X_{12} - 80X_{22} - 40X_{13} - 30X_{23}\)</span></p>
<p><code>linprog()</code> requires a mandatory input <code>c</code> which is a 1D array denoting the objective function. The following are some of its optional arguments:</p>
<ul>
<li><p><code>A_ub</code> - a 2D array for the left hand side of inequality constraints</p></li>
<li><p><code>b_ub</code> - a 1D array for the right hand side of inequality constraints</p></li>
<li><p><code>A_eq</code> - a 2D array for the left hand side of equality constraints</p></li>
<li><p><code>b_eq</code> - a 1D array for the right hand side of equality constraints</p></li>
<li><p><code>bounds</code> - a sequence of tuples denoting the minimum and maximum value of each variable. If only one tuple is defined, then the bounds apply to all variables</p></li>
<li><p><code>method</code> - the algorithm used to solver the problem. The default is <code>'highs'</code> and can also be set to <code>'highs-ds'</code> and <code>'highs-ipm'</code>. Other (legacy) methods are available at the moment but will soon be deprecated</p></li>
<li><p><code>callback</code> - callback function that will be run once per iteration of the algorithm</p></li>
<li><p><code>integrality</code> - a 1D array which specifies the integrality of each variable. This accepts a value of <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code> for each variable. <code>0</code> is the default and specifies that there is no integrality constraint, while <code>1</code> specifies that the variable must take an integer value. A value of <code>2</code> or <code>3</code> indicates that the variable is either continuous or integral within bounds, or is zero. This argument is only accepted by the <code>'highs'</code> method.</p></li>
</ul>
<p>Based on this, we can define variables to be used as inputs to the <code>c</code> and the first five arguments. When building the input arrays or lists, the order of the variables should be consistent. For our case, we will use the following order, which is how the variables appear in the minimization objective function:</p>
<p><span class="math inline">\(L, X_{11} , X_{21} , X_{12} , X_{22} , X_{13} , X_{23}\)</span></p>
<div id="247ad274" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>obj <span class="op">=</span> [<span class="dv">20</span>, <span class="op">-</span><span class="dv">140</span>, <span class="op">-</span><span class="dv">70</span>, <span class="op">-</span><span class="dv">120</span>, <span class="op">-</span><span class="dv">80</span>, <span class="op">-</span><span class="dv">40</span>, <span class="op">-</span><span class="dv">30</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>lhs_ineq <span class="op">=</span> [[<span class="op">-</span><span class="dv">1</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">200</span>, <span class="dv">300</span>],  <span class="co"># Labor constraint left side</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>],  <span class="co"># Plant 1 production constraint left side</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>]]  <span class="co"># Plant 2 production constraint left side</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>rhs_ineq <span class="op">=</span> [<span class="dv">5500</span>,  <span class="co"># Labor constraint right side</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            <span class="dv">10</span>,  <span class="co"># Plant 1 constraint right side</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="dv">12</span>]  <span class="co"># Plant 2 constraint right side</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># no equality constraints</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>bnd <span class="op">=</span> [(<span class="dv">0</span>, <span class="va">None</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can pass these into the arguments of&nbsp;<code>linprog()</code>&nbsp;to solve the problem. The function returns an object of type <code>scipy.optimize.OptimizeResult</code> that gives the optimum values of the decision variables in the field <code>x</code> and the minimum value of the objective function in the field <code>fun</code>.</p>
<div id="6d9a03e2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> linprog(c<span class="op">=</span>obj, A_ub<span class="op">=</span>lhs_ineq, b_ub<span class="op">=</span>rhs_ineq, bounds<span class="op">=</span>bnd)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>        message: Optimization terminated successfully. (HiGHS Status 7: Optimal)
        success: True
         status: 0
            fun: -2333.333333333333
              x: [ 0.000e+00  1.000e+01  0.000e+00  0.000e+00  1.167e+01
                   0.000e+00  0.000e+00]
            nit: 1
          lower:  residual: [ 0.000e+00  1.000e+01  0.000e+00  0.000e+00
                              1.167e+01  0.000e+00  0.000e+00]
                 marginals: [ 1.973e+01  0.000e+00  1.000e+01  2.000e+01
                              0.000e+00  1.000e+02  5.000e+01]
          upper:  residual: [       inf        inf        inf        inf
                                    inf        inf        inf]
                 marginals: [ 0.000e+00  0.000e+00  0.000e+00  0.000e+00
                              0.000e+00  0.000e+00  0.000e+00]
          eqlin:  residual: []
                 marginals: []
        ineqlin:  residual: [ 0.000e+00  0.000e+00  3.333e-01]
                 marginals: [-2.667e-01 -8.667e+01 -0.000e+00]
 mip_node_count: 0
 mip_dual_bound: 0.0
        mip_gap: 0.0</code></pre>
</div>
</div>
<p>The solver was able to find the optimal value of&nbsp;$2,333 (<code>fun</code>) achieved by shipping 10000 pcs from Plant 1 to Customer 1 and 11667 pieces from Plant 2 to Customer 2.</p>
</section>
<section id="solving-using-pulp" class="level1">
<h1>Solving using PuLP</h1>
<p><a href="https://coin-or.github.io/pulp/index.html">PuLP</a> is another package for optimization and is able to call external solvers to solve the model. I will again use <a href="https://realpython.com/linear-programming-python/">Mirko’s post</a> for the steps.</p>
<p>We first import the functions that we will use from the pulp package.</p>
<div id="dec40e7e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pulp <span class="im">import</span> LpMaximize, LpProblem, LpStatus, lpSum, LpVariable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first step is creating an object that represents the LP model using <code>LpProblem()</code> The sense argument specifies the objective of the problem which could either be <code>LpMinimize</code> (default, minimization) or <code>LpMaximize</code>. (maximization)</p>
<div id="e3c8e4b5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LpProblem(name<span class="op">=</span><span class="st">"sample-problem"</span>, sense<span class="op">=</span>LpMaximize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next step is defining the variables using the function <code>LpVariable()</code>. This function has the following arguments, of which only the first is mandatory</p>
<ul>
<li><p><code>name</code> - name of the variable</p></li>
<li><p><code>lowBound</code> , <code>upBound</code> - minimum and maxumum value of the variable. Default is negative infinity and positive infinity</p></li>
<li><p><code>cat</code> - The category of the variable. The default is <code>'Continuous'</code>, but can also be set as <code>'Integer'</code> or <code>'Binary'</code></p></li>
<li><p><code>e</code> - used for column-based modeling (we will not discuss further for this post)</p></li>
</ul>
<p>We then define the 7 decision variables with separate calls of <code>LpVariable()</code>:</p>
<div id="70052df1" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"L"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>x11 <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"x11"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>x12 <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"x12"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>x13 <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"x13"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>x21 <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"x21"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>x22 <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"x22"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>x23 <span class="op">=</span> LpVariable(name <span class="op">=</span> <span class="st">"x23"</span>, lowBound <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In a nutshell, constraints can be added to the model as inequalities/equalities, and the objective function can be added as an expression. To illustrate:</p>
<div id="132f31ce" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(<span class="dv">2</span><span class="op">*</span>L)) <span class="co"># This is an expression and represents 2 multiplied by L</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(<span class="dv">2</span><span class="op">*</span>L <span class="op">&lt;=</span> <span class="dv">5</span>)) <span class="co"># This is a constraint as it includes an inequality</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pulp.pulp.LpAffineExpression'&gt;
&lt;class 'pulp.pulp.LpConstraint'&gt;</code></pre>
</div>
</div>
<p>We will add these into the model by simply adding them into <code>model</code>. We will be writing them in full, but there are other functions in the package that can be used to construct expressions or constraints.</p>
<p>To add the (maximization) objective function, we write the following:</p>
<div id="2afad1da" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">+=</span> <span class="dv">140</span> <span class="op">*</span> x11 <span class="op">+</span> <span class="dv">70</span> <span class="op">*</span> x21 <span class="op">+</span> <span class="dv">120</span> <span class="op">*</span> x12 <span class="op">+</span> <span class="dv">80</span> <span class="op">*</span> x22 <span class="op">+</span> <span class="dv">40</span> <span class="op">*</span> x13 <span class="op">+</span> <span class="dv">30</span> <span class="op">*</span> x23 <span class="op">-</span> <span class="dv">20</span> <span class="op">*</span> L</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Constraints are added similarly, but as a tuple which includes a name for each constraint.</p>
<div id="f074bf60" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">+=</span> (<span class="dv">200</span> <span class="op">*</span> x11 <span class="op">+</span> <span class="dv">200</span> <span class="op">*</span> x12 <span class="op">+</span> <span class="dv">200</span> <span class="op">*</span> x13 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> x21 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> x22 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> x21 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> x23 <span class="op">-</span> L <span class="op">&lt;=</span> <span class="dv">5500</span>, <span class="st">"Labor"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">+=</span> (x11 <span class="op">+</span> x12 <span class="op">+</span> x13 <span class="op">&lt;=</span> <span class="dv">10</span>, <span class="st">"Plant1_Production"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">+=</span> (x21 <span class="op">+</span> x22 <span class="op">+</span> x23 <span class="op">&lt;=</span> <span class="dv">12</span>, <span class="st">"Plant2_Production"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calling the object displays the model we have defined.</p>
<div id="a0cc3181" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>sample-problem:
MAXIMIZE
-20*L + 140*x11 + 120*x12 + 40*x13 + 70*x21 + 80*x22 + 30*x23 + 0
SUBJECT TO
Labor: - L + 200 x11 + 200 x12 + 200 x13 + 600 x21 + 300 x22 + 300 x23 &lt;= 5500

Plant1_Production: x11 + x12 + x13 &lt;= 10

Plant2_Production: x21 + x22 + x23 &lt;= 12

VARIABLES
L Continuous
x11 Continuous
x12 Continuous
x13 Continuous
x21 Continuous
x22 Continuous
x23 Continuous</code></pre>
</div>
</div>
<p>We use <code>.solve()</code> to solve the model. A <code>solver</code> argument can be specified to override the default solver to be used. We use GLPK as the solver for this post.</p>
<div id="8c747624" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pulp <span class="im">import</span> GLPK</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>model.solve(solver<span class="op">=</span>GLPK(msg<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"status: </span><span class="sc">{</span>model<span class="sc">.</span>status<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>LpStatus[model.status]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"objective: </span><span class="sc">{</span>model<span class="sc">.</span>objective<span class="sc">.</span>value()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> model.variables():</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">.</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>var<span class="sc">.</span>value()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, constraint <span class="kw">in</span> model.constraints.items():</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>constraint<span class="sc">.</span>value()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>status: 1, Optimal
objective: 2333.3360000000002
L: 0.0
x11: 10.0
x12: 0.0
x13: 0.0
x21: 0.0
x22: 11.6667
x23: 0.0
Labor: 0.010000000000218279
Plant1_Production: 0.0
Plant2_Production: -0.3332999999999995</code></pre>
</div>
</div>
<p>The results show the same objective and decision variable values as SciPy.</p>
</section>
<section id="solving-using-ortools" class="level1">
<h1>Solving using ORTools</h1>
<p>The last package that we will test out in this post is <a href="https://developers.google.com/optimization">Google’s ORTools</a>. I will be using <a href="https://towardsdatascience.com/introduction-to-linear-programming-in-python-9261e7eb44b">Maximme’s post</a> as a guide where he mentions that the package is quite user-friendly and is the highest starred/rated on GitHub. The package also includes libraries specific to vehicle routing and graph problems.</p>
<p><code>pywraplp</code> is the linear programming solver wrapper which interfaces to MIP (mixed integer programming) and linear solvers. We use the code below to import the module and then declare a solver instance for our problem using <code>Solver()</code>. We specify GLOP as the engine to be used.</p>
<div id="721e4c45" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ortools.linear_solver <span class="im">import</span> pywraplp</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>solver <span class="op">=</span> pywraplp.Solver(<span class="st">'Maximize profit'</span>, pywraplp.Solver.GLOP_LINEAR_PROGRAMMING)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables can be added to the model or solver instance by using on of three functions depending on the variable type:</p>
<ul>
<li><p><code>NumVar</code> - continuous variables</p></li>
<li><p><code>IntVar</code> - integer variables</p></li>
<li><p><code>BoolVar</code> - binary variables</p></li>
</ul>
<p>The functions accept the lower-bound, the upper-bound and the variable name as inputs. To specify no upper-bound, we need to use <code>.infinity()</code> as a value.</p>
<p>Our model only contains continuous variables so we will just use <code>NumVar</code> to declare them. This approach is similar to what was done in PuLP.</p>
<div id="92915d0b" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>var_L <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'L'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>var_x11 <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'x11'</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>var_x12 <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'x12'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>var_x13 <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'x13'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>var_x21 <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'x21'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>var_x22 <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'x22'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>var_x23 <span class="op">=</span> solver.NumVar(<span class="dv">0</span>, solver.infinity(), <span class="st">'x23'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We add constraints using <code>.Add()</code> for each constraint and then passing the inequality (or equality) as an argument.</p>
<div id="0e475bbe" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>solver.Add(<span class="dv">200</span> <span class="op">*</span> var_x11 <span class="op">+</span> <span class="dv">200</span> <span class="op">*</span> var_x12 <span class="op">+</span> <span class="dv">200</span> <span class="op">*</span> var_x13 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> var_x21 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> var_x22 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> var_x21 <span class="op">+</span> <span class="dv">300</span> <span class="op">*</span> var_x23 <span class="op">-</span> var_L <span class="op">&lt;=</span> <span class="dv">5500</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>solver.Add(var_x11 <span class="op">+</span> var_x12 <span class="op">+</span> var_x13 <span class="op">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>solver.Add(var_x21 <span class="op">+</span> var_x22 <span class="op">+</span> var_x23 <span class="op">&lt;=</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;ortools.linear_solver.pywraplp.Constraint; proxy of &lt;Swig Object of type 'operations_research::MPConstraint *' at 0x000001FFCB089990&gt; &gt;</code></pre>
</div>
</div>
<p>The objective function can be defined by using <code>.Maximize()</code> or <code>.Minimize()</code> depending on the problem. We will be using the first one to define the original maxmimization version of the objective.</p>
<div id="ff2c9dac" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>solver.Maximize(<span class="dv">140</span> <span class="op">*</span> var_x11 <span class="op">+</span> <span class="dv">70</span> <span class="op">*</span> var_x21 <span class="op">+</span> <span class="dv">120</span> <span class="op">*</span> var_x12 <span class="op">+</span> <span class="dv">80</span> <span class="op">*</span> var_x22 <span class="op">+</span> <span class="dv">40</span> <span class="op">*</span> var_x13 <span class="op">+</span> <span class="dv">30</span> <span class="op">*</span> var_x23 <span class="op">-</span> <span class="dv">20</span> <span class="op">*</span> var_L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the model defined</p>
<div id="93b1938c" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>status <span class="op">=</span> solver.Solve()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Optimized: '</span>, status <span class="op">==</span> pywraplp.Solver.OPTIMAL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimized:  True</code></pre>
</div>
</div>
<p>We can display the objective value and the decision variables by calling the specific objects in <code>solver</code>.</p>
<div id="647d09c3" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Objective value = </span><span class="sc">{</span>solver<span class="sc">.</span>Objective()<span class="sc">.</span>Value()<span class="sc">:0.1f}</span><span class="ss">"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> solver.variables():</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>i<span class="sc">.</span>solution_value()<span class="sc">:0.1f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Objective value = 2333.3
L = 0.0
x11 = 10.0
x12 = 0.0
x13 = 0.0
x21 = 0.0
x22 = 11.7
x23 = 0.0</code></pre>
</div>
</div>
<p>We again see that the output is the same as the previous two. The method of defining variables, constraints, and the objective function is very similar to PuLP, but all three methods produced the same results.</p>
</section>
<section id="initial-thoughts" class="level1">
<h1>Initial Thoughts</h1>
<p>We have gone through three different ways to solve LP problems in Python. It is too early for me to tell which one is best for me. The last two appear more user-friendly when coding in variables and constraints, but I am not sure how easy they are to use for large-scale problems where you will load the coefficients of the objective function or the constraints from a separate file or spreadsheet.</p>
<p>This demo is also limited to a very simple linear problem– there are no integer or binary variables. We also did not go through any further analysis (e.g., sensitivity analysis) and these should be considered when choosing a package to use or focus on.</p>
<p>For now, I have three new packages in my toolset and I will definitely play around and explore some more.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>